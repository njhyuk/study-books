# 4.3 오류 전달 방법

오류가 발생하면 일반적으로 더 높은 계층으로 알려야 함

* 복구 불가 Case : 더 높은 계층으로 알려서 실행을 중지하고, 오류 기록 OR 전체 시스템 종료
* 복구 가능 Case : 즉시 호출하는쪽 (또는 한두 수준 위) 정상 처리하도록 해야함

이 작업을 수행하는 법

* 명시적 방법 : 직접 호출한 쪽에서 인지할 수 밖에 없도록
  * 검사 예외 (Checked Exception)
  * 널 반환, 옵셔널 반환, 리절트 반환, 아웃컴 반환, 스위프트 오류
* 암시적 방법 : 문서나 코드를 읽어야함
  * 비검사 예외 (Unchecked Exception)
  * 매직값 반환, 프로미스 또는 퓨처, 어서션, 체크, 패닉

## 4.3.1 요약: 예외

## 4.3.2 명시적 방법 : 검사 예외

호출하는 쪽에서 예외를 인지하도록 강제적으로 조치함.

* (예제 4.8) 음수가 입력되면 NegativeNumberException 검사 예외 발생
* (예제 4.9) 검사 예외 포착 : 호출하는 쪽에서 catch 구문, 로그 처리
* (예제 4.10) 검사 예외를 포착하지 않음 : throws NegativeNumberException 선언

## 4.3.3 암시적 방법 : 비검사 예외

호출하는 쪽에서 모를 수 있음. 문서화 하는것을 잊어버릴 때가 있다.

* (예제 4.11) NegativeNumberException 을 비검사 예외로 바꿈
* (예제 4.12) 검사 예외 포착 : NegativeNumberException 를 catch 함 (안해도 됨)
* (예제 4.13) 검사 예외 처리 X : 예외를 catch 하지 않음 (예외 처리 코드를 만날때 까지 올라감)

## 4.3.4 명시적 방법: 널값이 가능한 반환 유형

* 특정값을 계산하거나 얻는게 불가능할때 효과적
* null safe 지원하는 언어면 호출하는 쪽에서 강제적으로 인지함
  * 지원하지 않는 언어면 옵셔널을 반환하라.

### 널값 처리

* (예제 4.14) 입력값이 음수면 널값 반환, 널값의 의미가 직관적이지 않아 주석 필요

### 널값 처리

* (예제 4.15) 호출하는 쪽에서 리턴값이 널인지 확인하는 if 문 처리


## 4.3.5 명시적 방법: 리절트 반환 유형

* 널값이나 옵셔널 타입 반환의 문제 - 오류 정보 전달 불가능
* 호출자에게 값을 얻을수 없음을 알리거나, 얻을 수 없는 이유를 알려주면 유용 - Result 사용 적절
* (예제 4.16)
  * `class Result<V, E>` 제네릭/템플릿으로 어떤 유형의 값이나 오류에 대해서도 사용 가능
  * 생성자 private : (정적 팩토리 함수 강제화)
  * 정적 팩토리 함수 ofValue, ofError (값이나 오류 중 한가지로만 인스턴스 생성 가능)
  * 약점
    * 개발자가 `getValue()` 를 호출하기 전에 `hasError()` 를 확인 하지 않으면 무용지물

### 리절트 유형을 통한 전달

* (예제 4.17)
  * 예외 : `Result.ofError(new NegativeNumberException(value))`
  * 정상 : `Result.ofValue(정상값)`

### 리절트 처리

* (예제 4.18) : 호출부에서 hasError() if 문 먼저 처리, else 문에서 getValue() 사용

## 4.3.6 명시적 방법: 아웃컴 반환 유형

* 리턴할 값이 없는 함수라면? 성공/실패 여부를 리턴하는 방법
* (예제 4.19) 오류면 false, 성공하면 true

### 아웃컴 처리

* (예제 4.20) 성공/실패 여부 boolean 값에 따른 if 문 처리

### 아웃컴이 무시되지 않도록 보장

* 아웃컴 단점 : 호출하는 쪽에서 처리 잊을 수 있음 (예제 4.21 - 성공여부 확인 안함)
* 일부 언어에선 반환값을 무시하면 경고를 생성할 수 있다.
  * (예제 4.22) `@CheckReturnValue` 사용

## 4.3.7 암시적 방법: 프로미스 또는 퓨처

### 프로미스로 오류 전달

* (예제 4.24) await 로 실행 전 1초 대기
* 음수 리턴되어 예외 발생되면? 프로미스 거부
* 성공하면? 프로미스 거부

### 프로미스 처리

* (예제 4.25) then() 콜백은 프로미스가 이행될때 호출됨
* catch() 는 거부되면 호출됨

### 프로미스가 암묵적인 이유

catch() 함수를 통해 콜백이 제공 되지 않으면 상위 오류 수준에서 포착되거나 묻힘

### 프로미스를 명시적으로 만들기

(예제 4.26) Result 로 감싸서 반환한다 (너무 복잡해진다.)

### 4.3.8 암시적 방법: 매직값 반환

* 매직값(오류 코드) 반환의 일반적인 방법은 -1을 반환 하는 것 (예외 대신 -1 반환)
* 호출하는 쪽에 알릴 수 없어 버그로 이어질 수 있음
